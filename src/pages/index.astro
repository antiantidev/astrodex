---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import Hero from '../components/home/Hero.astro';
import TechStack from '../components/home/TechStack.astro';
import ProjectsShowcase from '../components/home/ProjectsShowcase.astro';
import Features from '../components/home/Features.astro';
import Workflow from '../components/home/Workflow.astro';
import FAQ from '../components/home/FAQ.astro';
import Stats from '../components/home/Stats.astro';

import { SITE_CONFIG } from '../site.config';

// Lấy dữ liệu thực tế cho stats và danh sách dự án
const allDocs = await getCollection('docs');
const totalArticles = allDocs.length;
const projectNames = [...new Set(allDocs.map(doc => doc.id.replace(/\\/g, "/").split("/")[0]))];
const totalProjects = projectNames.length;

// Lấy 3 dự án tiêu biểu
const featuredProjects = projectNames.slice(0, 3).map(id => {
	const projectDocs = allDocs.filter(d => d.id.replace(/\\/g, "/").startsWith(`${id}/`));
	const versions = [...new Set(projectDocs.map(d => {
        const path = d.id.replace(/\\/g, '/');
        const parts = path.split('/');
        if (parts.length >= 3 && parts[1].startsWith('v')) {
            return parts[1];
        }
        return String(d.data.version || 'v1.0.1');
    }))].sort().reverse();
	const latestVersion = versions[0];
	
	return {
		id,
		name: id.replace('-', ' ').toUpperCase(),
		link: `/docs/${id}`,
		docCount: projectDocs.length,
		versions: versions,
		latestVersion: latestVersion
	};
});

const buildTime = "1.2s"; 
const lighthouseScore = "100";
---

<Layout title={`${SITE_CONFIG.brand.name} | Premium Documentation Engine`}>
	<Hero />
    <TechStack />
    <ProjectsShowcase featuredProjects={featuredProjects} />
	<Features />
    <Workflow />
    <FAQ />
    <Stats 
        totalProjects={totalProjects} 
        totalArticles={totalArticles} 
        lighthouseScore={lighthouseScore} 
        buildTime={buildTime} 
    />
</Layout>